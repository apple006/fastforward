{
  "name": "FastForward",
  "tagline": "FastForward is an ultimate DevOps platform",
  "body": "# FastForward [![GoDoc](https://godoc.org/github.com/nofdev/fastforward?status.svg)](https://godoc.org/github.com/nofdev/fastforward) [![Build Status](https://travis-ci.org/nofdev/fastforward.svg?branch=master)](https://travis-ci.org/nofdev/fastforward)\r\nFastForward is an ultimate DevOps platform.\r\n\r\n\r\n## Quick-start provision OpenStack(mitaka) on xenil or trusty\r\n\r\n### Requirements\r\n\r\n* The OpenStack bare metal hosts are in MAAS environment(recommend)\r\n* All hosts are two NICs at least(external and internal)\r\n* We assume that you have ceph installed, the cinder bachend default using ceph, the running instace default to using ceph as it's local storage. About ceph please visit: http://docs.ceph.com/docs/master/rbd/rbd-openstack/ or see the (Option)Ceph Guide below.\r\n* For resize instance nova user can be login to each compute node via ssh passwordless(include sudo), and all compute nodes need to restart libvirt-bin to enable live migration\r\n* The FastForward node is the same as ceph-deploy node where can be login to each openstack node passwordless and sudo-passwordless\r\n* The FastForward node default using ~/.ssh/id_rsa ssh private key to logon remote server\r\n* You need to restart the `nova-compute`, `cinder-volume` and `glance-api` services to finalize the installation if you have selected the ceph as that backend\r\n* FastForward support consistency groups for future use but the default LVM and Ceph driver does not support consistency groups yet because the consistency technology is not available at that storage level\r\n\r\n### Install FastForward\r\n\r\nInstall FastForward on FASTFORWARD-NODE\r\n\r\n    pip install fastforward\r\n\r\n### Prepare environment\r\n\r\nPrepare the OpenStack environment.\r\n(NOTE) DO NOT setup eth1 in /etc/network/interfaces\r\n\r\n    ff --user ubuntu --hosts \\\r\n    HAPROXY1,\\\r\n    HAPROXY2,\\\r\n    CONTROLLER1,\\\r\n    CONTROLLER2,\\\r\n    COMPUTE1,\\\r\n    COMPUTE2,\\\r\n    COMPUTE3,\\\r\n    COMPUTE4,\\\r\n    COMPUTE5,\\\r\n    COMPUTE6,\\\r\n    COMPUTE7,\\\r\n    COMPUTE8,\\\r\n    COMPUTE9,\\\r\n    COMPUTE10 \\\r\n    environment \\\r\n    prepare-host --public-interface eth1\r\n\r\n### MySQL HA\r\n\r\nDeploy to CONTROLLER1\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack mysql install\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack mysql config --wsrep-cluster-address \"gcomm://CONTROLLER1,CONTROLLER2\" --wsrep-node-name=\"galera1\" --wsrep-node-address=\"CONTROLLER1\"\r\n\r\nDeploy to CONTROLLER2\r\n\r\n    ff --user ubuntu --hosts CONTROLLER2 openstack mysql install\r\n    ff --user ubuntu --hosts CONTROLLER2 openstack mysql config --wsrep-cluster-address \"gcomm://CONTROLLER1,CONTROLLER2\" --wsrep-node-name=\"galera2\" --wsrep-node-address=\"CONTROLLER2\"\r\n\r\nStart the cluster\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack mysql manage --wsrep-new-cluster\r\n    ff --user ubuntu --hosts CONTROLLER2 openstack mysql manage --start\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack mysql manage --change-root-password changeme\r\n\r\nShow the cluster status\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack mysql manage --show-cluster-status --root-db-pass changeme\r\n\r\n\r\n### HAProxy HA\r\n\r\nDeploy to HAPROXY1\r\n\r\n    ff --user ubuntu --hosts HAPROXY1 openstack haproxy install\r\n\r\nDeploy to HAPROXY2\r\n\r\n    ff --user ubuntu --hosts HAPROXY2 openstack haproxy install\r\n\r\nGenerate the HAProxy configuration and upload to target hosts(Do not forget to edit the generated configuration)\r\n\r\n    ff openstack haproxygen-conf\r\n    ff --user ubuntu --hosts HAPROXY1,HAPROXY2 openstack haproxy config --upload-conf haproxy.cfg\r\n\r\nConfigure Keepalived\r\n\r\n    ff --user ubuntu --hosts HAPROXY1 openstack haproxy config --configure-keepalived --router_id lb1 --priority 150 --state MASTER --interface eth0 --vip CONTROLLER_VIP\r\n    ff --user ubuntu --hosts HAPROXY2 openstack haproxy config --configure-keepalived --router_id lb2 --priority 100 --state SLAVE --interface eth0 --vip CONTROLLER_VIP\r\n\r\n### RabbitMQ HA\r\n\r\nDeploy to CONTROLLER1 and CONTROLLER2\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1,CONTROLLER2 openstack rabbitmq install --erlang-cookie changemechangeme --rabbit-user openstack --rabbit-pass changeme\r\n\r\nCreate cluster(Ensure CONTROLLER2 can access CONTROLLER1 via hostname)\r\n\r\n    ff --user ubuntu --hosts CONTROLLER2 openstack rabbitmq join-cluster --name rabbit@CONTROLLER1\r\n\r\n### Keystone HA\r\n\r\nCreate keystone database\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack keystone create-keystone-db --root-db-pass changeme --keystone-db-pass changeme\r\n\r\nInstall keystone on CONTROLLER1 and CONTROLLER2\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack keystone install --admin-token changeme --connection mysql+pymysql://keystone:changeme@CONTROLLER_VIP/keystone --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211 --populate\r\n    ff --user ubuntu --hosts CONTROLLER2 openstack keystone install --admin-token changeme --connection mysql+pymysql://keystone:changeme@CONTROLLER_VIP/keystone --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211\r\n\r\nCreate the service entity and API endpoints\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack keystone create-entity-and-endpoint --os-token changeme --os-url http://CONTROLLER_VIP:35357/v3 --public-endpoint http://CONTROLLER_VIP:5000/v3 --internal-endpoint http://CONTROLLER_VIP:5000/v3 --admin-endpoint http://CONTROLLER_vip:35357/v3\r\n\r\nCreate projects, users, and roles\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack keystone create-projects-users-roles --os-token changeme --os-url http://CONTROLLER_VIP:35357/v3 --admin-pass changeme --demo-pass changeme\r\n\r\n(OPTION) you will need to create OpenStack client environment scripts\r\nadmin-openrc.sh\r\n\r\n    export OS_PROJECT_DOMAIN_NAME=default\r\n    export OS_USER_DOMAIN_NAME=default\r\n    export OS_PROJECT_NAME=admin\r\n    export OS_TENANT_NAME=admin\r\n    export OS_USERNAME=admin\r\n    export OS_PASSWORD=changeme\r\n    export OS_AUTH_URL=http://CONTROLLER_VIP:35357/v3\r\n    export OS_IDENTITY_API_VERSION=3\r\n    export OS_IMAGE_API_VERSION=2\r\n    export OS_AUTH_VERSION=3\r\n\r\ndemo-openrc.sh\r\n\r\n    export OS_PROJECT_DOMAIN_NAME=default\r\n    export OS_USER_DOMAIN_NAME=default\r\n    export OS_PROJECT_NAME=demo\r\n    export OS_TENANT_NAME=demo\r\n    export OS_USERNAME=demo\r\n    export OS_PASSWORD=changeme\r\n    export OS_AUTH_URL=http://CONTROLLER_VIP:5000/v3\r\n    export OS_IDENTITY_API_VERSION=3\r\n    export OS_IMAGE_API_VERSION=2\r\n    export OS_AUTH_VERSION=3\r\n\r\n### Glance HA\r\n\r\nCreate glance database\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack glance create-glance-db --root-db-pass changeme --glance-db-pass changeme\r\n\r\nCreate service credentials\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack glance create-service-credentials --os-password changeme --os-auth-url http://CONTROLLER_VIP:35357/v3 --glance-pass changeme --public-endpoint http://CONTROLLER_VIP:9292 --internal-endpoint http://CONTROLLER_VIP:9292 --admin-endpoint http://CONTROLLER_VIP:9292\r\n\r\nInstall glance on CONTROLLER1 and CONTROLLER2\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack glance install --connection mysql+pymysql://glance:GLANCE_PASS@CONTROLLER_VIP/glance --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --glance-pass changeme --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211 --populate\r\n    ff --user ubuntu --hosts CONTROLLER2 openstack glance install --connection mysql+pymysql://glance:GLANCE_PASS@CONTROLLER_VIP/glance --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --glance-pass changeme --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211\r\n\r\n### Nova HA\r\n\r\nCreate nova database\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack nova create-nova-db --root-db-pass changeme --nova-db-pass changeme\r\n\r\nCreate service credentials\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack nova create-service-credentials --os-password changeme --os-auth-url http://CONTROLLER_VIP:35357/v3 --nova-pass changeme --public-endpoint 'http://CONTROLLER_VIP:8774/v2.1/%\\(tenant_id\\)s' --internal-endpoint 'http://CONTROLLER_VIP:8774/v2.1/%\\(tenant_id\\)s' --admin-endpoint 'http://CONTROLLER_VIP:8774/v2.1/%\\(tenant_id\\)s'\r\n\r\nInstall nova on CONTROLLER1\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack nova install --connection mysql+pymysql://nova:NOVA_PASS@CONTROLLER_VIP/nova --api-connection mysql+pymysql://nova:NOVA_PASS@CONTROLLER_VIP/nova_api --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --nova-pass changeme --my-ip MANAGEMENT_IP --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211 --rabbit-hosts CONTROLLER1,CONTROLLER2 --rabbit-user openstack --rabbit-pass changeme --glance-api-servers http://CONTROLLER_VIP:9292 --neutron-endpoint http://CONTROLLER_VIP:9696 --neutron-pass changeme --metadata-proxy-shared-secret changeme --populate\r\n\r\nInstall nova on CONTROLLER2\r\n\r\n    ff --user ubuntu --hosts CONTROLLER2 openstack nova install --connection mysql+pymysql://nova:NOVA_PASS@CONTROLLER_VIP/nova --api-connection mysql+pymysql://nova:NOVA_PASS@CONTROLLER_VIP/nova_api --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --nova-pass changeme --my-ip MANAGEMENT_IP --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211 --rabbit-hosts CONTROLLER1,CONTROLLER2 --rabbit-user openstack --rabbit-pass changeme --glance-api-servers http://CONTROLLER_VIP:9292 --neutron-endpoint http://CONTROLLER_VIP:9696 --neutron-pass changeme --metadata-proxy-shared-secret changeme\r\n\r\n### Nova Compute\r\n\r\nAdd nova computes(use `uuidgen` to generate the ceph uuid)\r\n\r\n    ff --user ubuntu --hosts COMPUTE1 openstack nova-compute install --my-ip MANAGEMENT_IP --rabbit-hosts CONTROLLER1,CONTROLLER2 --rabbit-user openstack --rabbit-pass changeme --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --nova-pass changeme --novncproxy-base-url http://CONTROLLER_VIP:6080/vnc_auto.html --glance-api-servers http://CONTROLLER_VIP:9292 --neutron-endpoint http://CONTROLLER_VIP:9696 --neutron-pass changeme --rbd-secret-uuid changeme-changeme-changeme-changeme --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211\r\n    ff --user ubuntu --hosts COMPUTE2 openstack nova-compute install --my-ip MANAGEMENT_IP --rabbit-hosts CONTROLLER1,CONTROLLER2 --rabbit-user openstack --rabbit-pass changeme --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --nova-pass changeme --novncproxy-base-url http://CONTROLLER_VIP:6080/vnc_auto.html --glance-api-servers http://CONTROLLER_VIP:9292 --neutron-endpoint http://CONTROLLER_VIP:9696 --neutron-pass changeme --rbd-secret-uuid changeme-changeme-changeme-changeme --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211\r\n\r\nThe libvirt defaults to using ceph as shared storage, the ceph pool for running instance is vms. if you do not using ceph as it's bachend, you must remove the following param:\r\n\r\n    images_type = rbd\r\n    images_rbd_pool = vms\r\n    images_rbd_ceph_conf = /etc/ceph/ceph.conf\r\n    rbd_user = cinder\r\n    rbd_secret_uuid = changeme-changeme-changeme-changeme\r\n    disk_cachemodes=\"network=writeback\"\r\n    live_migration_flag=\"VIR_MIGRATE_UNDEFINE_SOURCE,VIR_MIGRATE_PEER2PEER,VIR_MIGRATE_LIVE,VIR_MIGRATE_PERSIST_DEST,VIR_MIGRATE_TUNNELLED\"\r\n\r\n\r\n### Neutron HA\r\n\r\nCreate nova database\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack neutron create-neutron-db --root-db-pass changeme --neutron-db-pass changeme\r\n\r\nCreate service credentials\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack neutron create-service-credentials --os-password changeme --os-auth-url http://CONTROLLER_VIP:35357/v3 --neutron-pass changeme --public-endpoint http://CONTROLLER_VIP:9696 --internal-endpoint http://CONTROLLER_VIP:9696 --admin-endpoint http://CONTROLLER_VIP:9696\r\n\r\nInstall Neutron for self-service\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack neutron install --connection mysql+pymysql://neutron:NEUTRON_PASS@CONTROLLER_VIP/neutron --rabbit-hosts CONTROLLER1,CONTROLLER2 --rabbit-user openstack --rabbit-pass changeme --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --neutron-pass changeme --nova-url http://CONTROLLER_VIP:8774/v2.1 --nova-pass changeme --public-interface eth1 --local-ip MANAGEMENT_INTERFACE_IP --nova-metadata-ip CONTROLLER_VIP --metadata-proxy-shared-secret changeme-changeme-changeme-changeme --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211 --populate\r\n    ff --user ubuntu --hosts CONTROLLER2 openstack neutron install --connection mysql+pymysql://neutron:NEUTRON_PASS@CONTROLLER_VIP/neutron --rabbit-hosts CONTROLLER1,CONTROLLER2 --rabbit-user openstack --rabbit-pass changeme --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --neutron-pass changeme --nova-url http://CONTROLLER_VIP:8774/v2.1 --nova-pass changeme --public-interface eth1 --local-ip MANAGEMENT_INTERFACE_IP --nova-metadata-ip CONTROLLER_VIP --metadata-proxy-shared-secret changeme-changeme-changeme-changeme --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211\r\n\r\n\r\n### Neutron Agent\r\n\r\nInstall neutron agent on compute nodes\r\n\r\n    ff --user ubuntu --hosts COMPUTE1 openstack neutron-agent install --rabbit-hosts CONTROLLER1,CONTROLLER2 --rabbit-user openstack --rabbit-pass changeme --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --neutron-pass changeme --public-interface eth1 --local-ip MANAGEMENT_INTERFACE_IP --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211\r\n    ff --user ubuntu --hosts COMPUTE2 openstack neutron-agent install --rabbit-hosts CONTROLLER1,CONTROLLER2 --rabbit-user openstack --rabbit-pass changeme --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --neutron-pass changeme --public-interface eth1 --local-ip MANAGEMENT_INTERFACE_IP --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211\r\n\r\n\r\n### Horizon HA\r\n\r\nInstall horizon on controller nodes\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1,CONTROLLER2 openstack horizon install --openstack-host CONTROLLER_VIP  --memcached-servers CONTROLLER1:11211 --time-zone Asia/Shanghai\r\n\r\n\r\n### Cinder HA\r\n\r\nCreate cinder database\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack cinder create-cinder-db --root-db-pass changeme --cinder-db-pass changeme\r\n\r\nCreate cinder service creadentials\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack cinder create-service-credentials --os-password changeme --os-auth-url http://CONTROLLER_VIP:35357/v3 --cinder-pass changeme --public-endpoint-v1 'http://CONTROLLER_VIP:8776/v1/%\\(tenant_id\\)s' --internal-endpoint-v1 'http://CONTROLLER_VIP:8776/v1/%\\(tenant_id\\)s' --admin-endpoint-v1 'http://CONTROLLER_VIP:8776/v1/%\\(tenant_id\\)s' --public-endpoint-v2 'http://CONTROLLER_VIP:8776/v2/%\\(tenant_id\\)s' --internal-endpoint-v2 'http://CONTROLLER_VIP:8776/v2/%\\(tenant_id\\)s' --admin-endpoint-v2 'http://CONTROLLER_VIP:8776/v2/%\\(tenant_id\\)s'\r\n\r\nInstall cinder-api and cinder-volume on controller nodes, the volume backend defaults to ceph (you must have ceph installed)\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack cinder install --connection mysql+pymysql://cinder:CINDER_PASS@CONTROLLER_VIP/cinder --rabbit-user openstack --rabbit-pass changeme --rabbit-hosts CONTROLLER1,CONTROLLER2 --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --cinder-pass changeme --my-ip MANAGEMENT_INTERFACE_IP --glance-api-servers http://CONTROLLER_VIP:9292 --rbd-secret-uuid changeme-changeme-changeme-changeme --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211 --populate\r\n    ff --user ubuntu --hosts CONTROLLER2 openstack cinder install --connection mysql+pymysql://cinder:CINDER_PASS@CONTROLLER_VIP/cinder --rabbit-user openstack --rabbit-pass changeme --rabbit-hosts CONTROLLER1,CONTROLLER2 --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --cinder-pass changeme --my-ip MANAGEMENT_INTERFACE_IP --glance-api-servers http://CONTROLLER_VIP:9292 --rbd-secret-uuid changeme-changeme-changeme-changeme --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211\r\n\r\n### Swift proxy HA\r\n\r\nCreate the Identity service credentials\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift create-service-credentials --os-password changeme --os-auth-url http://CONTROLLER_VIP:35357/v3 --swift-pass changeme --public-endpoint 'http://CONTROLLER_VIP:8080/v1/AUTH_%\\(tenant_id\\)s' --internal-endpoint 'http://CONTROLLER_VIP:8080/v1/AUTH_%\\(tenant_id\\)s' --admin-endpoint http://CONTROLLER_VIP:8080/v1\r\n\r\nInstall swift proxy\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1,CONTROLLER2 openstack swift install --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --swift-pass changeme --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211\r\n\r\n\r\n### Swift storage\r\n\r\nPrepare disks on storage node\r\n\r\n    ff --user ubuntu --hosts OBJECT1,OBJECT2 openstack swift-storage prepare-disks --name sdb,sdc,sdd,sde\r\n\r\nInstall swift storage on storage node\r\n\r\n    ff --user ubuntu --hosts OBJECT1 openstack swift-storage install --address MANAGEMENT_INTERFACE_IP --bind-ip MANAGEMENT_INTERFACE_IP\r\n    ff --user ubuntu --hosts OBJECT2 openstack swift-storage install --address MANAGEMENT_INTERFACE_IP --bind-ip MANAGEMENT_INTERFACE_IP\r\n\r\nCreate account ring on controller node\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage create-account-builder-file --partitions 10 --replicas 3 --moving 1\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage account-builder-add --region 1 --zone 1 --ip OBJECT1_MANAGEMENT_IP --device sdb --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage account-builder-add --region 1 --zone 1 --ip OBJECT1_MANAGEMENT_IP --device sdc --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage account-builder-add --region 1 --zone 1 --ip OBJECT1_MANAGEMENT_IP --device sdd --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage account-builder-add --region 1 --zone 1 --ip OBJECT1_MANAGEMENT_IP --device sde --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage account-builder-add --region 1 --zone 1 --ip OBJECT2_MANAGEMENT_IP --device sdb --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage account-builder-add --region 1 --zone 1 --ip OBJECT2_MANAGEMENT_IP --device sdc --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage account-builder-add --region 1 --zone 1 --ip OBJECT2_MANAGEMENT_IP --device sdd --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage account-builder-add --region 1 --zone 1 --ip OBJECT2_MANAGEMENT_IP --device sde --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage account-builder-rebalance\r\n\r\nCreate container ring on controller node\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage create-container-builder-file --partitions 10 --replicas 3 --moving 1\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage container-builder-add --region 1 --zone 1 --ip OBJECT1_MANAGEMENT_IP --device sdb --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage container-builder-add --region 1 --zone 1 --ip OBJECT1_MANAGEMENT_IP --device sdc --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage container-builder-add --region 1 --zone 1 --ip OBJECT1_MANAGEMENT_IP --device sdd --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage container-builder-add --region 1 --zone 1 --ip OBJECT1_MANAGEMENT_IP --device sde --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage container-builder-add --region 1 --zone 1 --ip OBJECT2_MANAGEMENT_IP --device sdb --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage container-builder-add --region 1 --zone 1 --ip OBJECT2_MANAGEMENT_IP --device sdc --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage container-builder-add --region 1 --zone 1 --ip OBJECT2_MANAGEMENT_IP --device sdd --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage container-builder-add --region 1 --zone 1 --ip OBJECT2_MANAGEMENT_IP --device sde --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage container-builder-rebalance\r\n\r\nCreate object ring on controller node\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage create-object-builder-file --partitions 10 --replicas 3 --moving 1\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage object-builder-add --region 1 --zone 1 --ip OBJECT1_MANAGEMENT_IP --device sdb --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage object-builder-add --region 1 --zone 1 --ip OBJECT1_MANAGEMENT_IP --device sdc --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage object-builder-add --region 1 --zone 1 --ip OBJECT1_MANAGEMENT_IP --device sdd --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage object-builder-add --region 1 --zone 1 --ip OBJECT1_MANAGEMENT_IP --device sde --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage object-builder-add --region 1 --zone 1 --ip OBJECT2_MANAGEMENT_IP --device sdb --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage object-builder-add --region 1 --zone 1 --ip OBJECT2_MANAGEMENT_IP --device sdc --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage object-builder-add --region 1 --zone 1 --ip OBJECT2_MANAGEMENT_IP --device sdd --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage object-builder-add --region 1 --zone 1 --ip OBJECT2_MANAGEMENT_IP --device sde --weight 100\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack swift-storage object-builder-rebalance\r\n\r\n Sync the builder file from controller node to each storage node and other any proxy node\r\n\r\n    ff --user ubuntu --host CONTROLLER1 openstack swift-storage sync-builder-file --to CONTROLLER2,OBJECT1,OBJECT2\r\n\r\nFinalize installation on all nodes\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1,CONTROLLER2,OBJECT1,OBJECT2 openstack swift finalize-install --swift-hash-path-suffix changeme --swift-hash-path-prefix changeme\r\n\r\n### Ceph Guide\r\n\r\nFor more information about ceph backend visit:\r\n\r\n[preflight](http://docs.ceph.com/docs/jewel/start/quick-start-preflight/)\r\n\r\n[Cinder and Glance driver](http://docs.ceph.com/docs/jewel/rbd/rbd-openstack/)\r\n\r\nOn Xenial please using ceph-deploy version 1.5.34\r\n\r\nInstall ceph-deploy(1.5.34)\r\n\r\n    wget -q -O- 'https://download.ceph.com/keys/release.asc' | sudo apt-key add -\r\n    echo deb http://download.ceph.com/debian-jewel/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list\r\n    sudo apt-get update && sudo apt-get install ceph-deploy\r\n\r\nCreate ceph cluster directory\r\n\r\n    mkdir ceph-cluster\r\n    cd ceph-cluster\r\n\r\nCreate cluster and add initial monitor(s) to the ceph.conf\r\n\r\n    ceph-deploy new  CONTROLLER1 CONTROLLER2 COMPUTE1 COMPUTE2 BLOCK1 BLOCK2\r\n    echo \"osd pool default size = 2\" | tee -a ceph.conf\r\n\r\nInstall ceph client(Optionaly you can use `--release jewel` to install jewel version, the ceph-deploy 1.5.34 default release is jewel) and you can use `--repo-url http://your-local-repo.example.org/mirror/download.ceph.com/debian-jewel` to specify the local repository.\r\n\r\n    ceph-deploy install PLAYBACK-NODE CONTROLLER1 CONTROLLER2 COMPUTE1 COMPUTE2 BLOCK1 BLOCK2\r\n\r\nAdd the initial monitor(s) and gather the keys\r\n\r\n    ceph-deploy mon create-initial\r\n\r\nIf you want to add additional monitors, do that\r\n\r\n    ceph-deploy mon add {additional-monitor}\r\n\r\nAdd ceph osd(s)\r\n\r\n    ceph-deploy osd create --zap-disk BLOCK1:/dev/sdb\r\n    ceph-deploy osd create --zap-disk BLOCK1:/dev/sdc\r\n    ceph-deploy osd create --zap-disk BLOCK2:/dev/sdb\r\n    ceph-deploy osd create --zap-disk BLOCK2:/dev/sdc\r\n\r\nSync admin key\r\n\r\n    ceph-deploy admin PLAYBACK-NODE CONTROLLER1 CONTROLLER2 COMPUTE1 COMPUTE2 BLOCK1 BLOCK2\r\n    sudo chmod +r /etc/ceph/ceph.client.admin.keyring # On all ceph clients node\r\n\r\nCreate osd pool for cinder and running instance\r\n\r\n    ceph osd pool create volumes 512\r\n    ceph osd pool create vms 512\r\n    ceph osd pool create images 512\r\n\r\nSetup ceph client authentication\r\n\r\n    ceph auth get-or-create client.cinder mon 'allow r' osd 'allow class-read object_prefix rbd_children, allow rwx pool=volumes, allow rwx pool=vms, allow rx pool=images'\r\n    ceph auth get-or-create client.glance mon 'allow r' osd 'allow class-read object_prefix rbd_children, allow rwx pool=images'\r\n\r\nAdd the keyrings for `client.cinder` and `client.glance` to appropriate nodes and change their ownership\r\n\r\n    ceph auth get-or-create client.cinder | sudo tee /etc/ceph/ceph.client.cinder.keyring # On all cinder-volume nodes\r\n    sudo chown cinder:cinder /etc/ceph/ceph.client.cinder.keyring\" # On all cinder-volume nodes\r\n\r\n    ceph auth get-or-create client.glance | sudo tee /etc/ceph/ceph.client.glance.keyring # On all glance-api nodes\r\n    sudo chown glance:glance /etc/ceph/ceph.client.glance.keyring\" # On all glance-api nodes\r\n\r\nNodes running `nova-compute` need the keyring file for the `nova-compute` process\r\n\r\n    ceph auth get-or-create client.cinder | sudo tee /etc/ceph/ceph.client.cinder.keyring # On all nova-compute nodes\r\n\r\nThey also need to store the secret key of the `client.cinder user` in `libvirt`. The libvirt process needs it to access the cluster while attaching a block device from Cinder.\r\nCreate a temporary copy of the secret key on the nodes running `nova-compute`\r\n\r\n    ceph auth get-key client.cinder | tee client.cinder.key # On all nova-compute nodes\r\n\r\nThen, on the `compute nodes`, add the secret key to `libvirt` and remove the temporary copy of the key(the uuid is the same as your --rbd-secret-uuid option, you have to save the uuid for later)\r\n\r\n    uuidgen\r\n    457eb676-33da-42ec-9a8c-9293d545c337\r\n\r\n    # The following steps on all nova-compute nodes\r\n    cat > secret.xml <<EOF\r\n    <secret ephemeral='no' private='no'>\r\n      <uuid>457eb676-33da-42ec-9a8c-9293d545c337</uuid>\r\n      <usage type='ceph'>\r\n        <name>client.cinder secret</name>\r\n      </usage>\r\n    </secret>\r\n    EOF\r\n    sudo virsh secret-define --file secret.xml\r\n    Secret 457eb676-33da-42ec-9a8c-9293d545c337 created\r\n    sudo virsh secret-set-value --secret 457eb676-33da-42ec-9a8c-9293d545c337 --base64 $(cat client.cinder.key) && rm client.cinder.key secret.xml\r\n\r\n(optional)Now on every compute nodes edit your Ceph configuration file, add the client section\r\n\r\n    [client]\r\n    rbd cache = true\r\n    rbd cache writethrough until flush = true\r\n    rbd concurrent management ops = 20\r\n\r\n    [client.cinder]\r\n    keyring = /etc/ceph/ceph.client.cinder.keyring\r\n\r\n(optional)On every glance-api nodes edit your Ceph configuration file, add the client section\r\n\r\n    [client.glance]\r\n    keyring= /etc/ceph/ceph.client.glance.keyring\r\n\r\n(optional)If you want to remove osd\r\n\r\n    sudo stop ceph-mon-all && sudo stop ceph-osd-all # On osd node\r\n    ceph osd out {OSD-NUM}\r\n    ceph osd crush remove osd.{OSD-NUM}\r\n    ceph auth del osd.{OSD-NUM}\r\n    ceph osd rm {OSD-NUM}\r\n    ceph osd crush remove {HOST}\r\n\r\n(optional)If you want to remove monitor\r\n\r\n    ceph mon remove {MON-ID}\r\n\r\nNotes: you need to restart the `nova-compute`, `cinder-volume` and `glance-api` services to finalize the installation.\r\n\r\n### Shared File Systems service\r\n\r\nCreate manila database and service credentials\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack manila create-manila-db --root-db-pass CHANGEME --manila-db-pass CHANGEME\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack manila create-service-credentials --os-password CHANGEME --os-auth-url http://CONTROLLER_VIP:35357/v3 --manila-pass CHANGEME --public-endpoint-v1 \"http://CONTROLLER_VIP:8786/v1/%\\(tenant_id\\)s\" --internal-endpoint-v1 \"http://CONTROLLER_VIP:8786/v1/%\\(tenant_id\\)s\" --admin-endpoint-v1 \"http://CONTROLLER_VIP:8786/v1/%\\(tenant_id\\)s\" --public-endpoint-v2 \"http://CONTROLLER_VIP:8786/v2/%\\(tenant_id\\)s\" --internal-endpoint-v2 \"http://CONTROLLER_VIP:8786/v2/%\\(tenant_id\\)s\" --admin-endpoint-v2 \"http://CONTROLLER_VIP:8786/v2/%\\(tenant_id\\)s\"\r\n\r\nInstall manila on CONTROLLER1 and CONTROLLER2\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack manila install --connection mysql+pymysql://manila:CHANGEME@CONTROLLER_VIP/manila --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --manila-pass CHANGEME --my-ip CONTROLLER1 --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211 --rabbit-hosts CONTROLLER1,CONTROLLER2 --rabbit-user openstack --rabbit-pass CHANGEME --populate\r\n    ff --user ubuntu --hosts CONTROLLER2 openstack manila install --connection mysql+pymysql://manila:CHANGEME@CONTROLLER_VIP/manila --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --manila-pass CHANGEME --my-ip CONTROLLER2 --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211 --rabbit-hosts CONTROLLER1,CONTROLLER2 --rabbit-user openstack --rabbit-pass CHANGEME\r\n\r\nInstall manila share on CONTROLLER1 and CONTROLLER2\r\n\r\n    ff --user ubuntu --hosts CONTROLLER1 openstack manila-share install --connection mysql+pymysql://manila:CHANGEME@CONTROLLER_VIP/manila --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --manila-pass CHANGEME --my-ip CONTROLLER1 --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211 --rabbit-hosts CONTROLLER1,CONTROLLER2 --rabbit-user openstack --rabbit-pass CHANGEME --neutron-endpoint http://CONTROLLER_VIP:9696 --neutron-pass CHANGEME --nova-pass CHANGEME --cinder-pass CHANGEME\r\n    ff --user ubuntu --hosts CONTROLLER2 openstack manila-share install --connection mysql+pymysql://manila:CHANGEME@CONTROLLER_VIP/manila --auth-uri http://CONTROLLER_VIP:5000 --auth-url http://CONTROLLER_VIP:35357 --manila-pass CHANGEME --my-ip CONTROLLER2 --memcached-servers CONTROLLER1:11211,CONTROLLER2:11211 --rabbit-hosts CONTROLLER1,CONTROLLER2 --rabbit-user openstack --rabbit-pass CHANGEME --neutron-endpoint http://CONTROLLER_VIP:9696 --neutron-pass CHANGEME --nova-pass CHANGEME --cinder-pass CHANGEME\r\n\r\nCreate the service image for manila\r\n\r\nhttp://docs.openstack.org/mitaka/install-guide-ubuntu/launch-instance-manila.html\r\n\r\nCreate shares with share servers management support\r\n\r\nhttp://docs.openstack.org/mitaka/install-guide-ubuntu/launch-instance-manila-dhss-true-option2.html\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}